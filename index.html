

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HINTS MUSIC</title>
    <!-- === SEO / META === -->
    <meta name="description" content="HINTS MUSIC is an independent music label. New releases: Nazareth, Sex & Limbo, SPACEDUST, Interstellar. Electronic music, hyperpop, experimental.">
    <meta name="keywords" content="HINTS MUSIC, music label, Slut Online, lindtayl0r, Nazareth, Sex & Limbo, SPACEDUST, Interstellar, electronic music, hyperpop">

    <!-- Open Graph -->
    <meta property="og:title" content="HINTS MUSIC — A new stage of electronic music">
    <meta property="og:description" content="The official website of the HINTS MUSIC label. New releases and events. New era soon.">
    <meta property="og:image" content="https://hintsmp3.github.io/HINTSMUSIC/IMG_7851.jpeg">
    <meta property="og:url" content="https://hintsmp3.github.io/HINTSMUSIC/">
    <meta property="og:type" content="website">

    <!-- Twitter / X -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="HINTS MUSIC">
    <meta name="twitter:description" content="A new stage of electronic music. Releases and events.">
    <meta name="twitter:image" content="https://hintsmp3.github.io/HINTSMUSIC/IMG_7851.jpeg">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "MusicGroup",
      "name": "HINTS MUSIC",
      "genre": ["Electronic", "Hyperpop", "Experimental"],
      "description": "An independent music label. New releases and events."
    }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Impact&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* === IMMERSIVE / IDLE MODE === */
        body.immersive .content-layer,
        body.immersive .custom-player {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
        }

        body.immersive {
            cursor: none;
        }

        @media (hover: none) and (pointer: coarse) {
            body.immersive {
                cursor: auto;
            }
        }

        body.immersive #glCanvas {
            opacity: 1;
        }

        body.immersive #grainCanvas {
            opacity: 0.06;
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
        }

        body {
            min-width: 320px;
        }

        body {
            min-height: 100vh;
            font-family: 'Bebas Neue', 'Impact', 'Arial Black', sans-serif;
            color: #fff;
            text-align: center;
            background: linear-gradient(rgba(255, 105, 255, 0.75), rgba(255, 200, 255, 0.65)),
                        url('IMG_7851.jpeg') center center / cover no-repeat scroll;
            position: relative;
            letter-spacing: 2px;
            overflow-x: hidden;
        }

        /* WebGL Canvas поверх фона с прозрачностью */
        #glCanvas, #grainCanvas {
            width: 130vw !important;
            height: 130vh !important;
            transform: translate(-5%, -5%);
        }

        #glCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.85;
            mix-blend-mode: lighten;
            pointer-events: none;
            filter: saturate(1.25) contrast(1.1);
        }

        #grainCanvas {
            position: fixed;
            inset: 0;
            z-index: 3;              /* выше glCanvas, ниже UI */
            pointer-events: none;
            mix-blend-mode: soft-light; /* можно soft-light */
            opacity: 0.0061;
        }
        .news-arrow, .play-pause, .news-close {
            min-width: 44px;
            min-height: 44px;
            touch-action: manipulation;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        /* Слой контента */
        .content-layer {
            position: relative;
            z-index: 2;
            padding: 0 0 140px;
        }

        /* Частицы */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(255, 105, 255, 0.8);
            border-radius: 50%;
            animation: float linear infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(1);
                opacity: 0;
            }
        }

        h1 {
            font-family: 'Bebas Neue', 'Impact', sans-serif;
            font-size: 5em;
            margin: 88px 0 66px;
            text-shadow: 
                0 0 20px #ffffff,
                0 0 40px #ff69ff,
                5px 5px 0 #000;
            animation: glow 3.14s infinite alternate;
            position: relative;
            z-index: 3;
            transition: all 0.4s ease;
        }

        @keyframes glow {
            from { 
                text-shadow: 0 0 20px #ffffff, 0 0 40px #ff69ff, 5px 5px 0 #000;
                transform: scale(1);
            }
            to { 
                text-shadow: 0 0 40px #ffffff, 0 0 80px #ff69ff, 8px 8px 0 #000;
                transform: scale(1.05);
            }
        }

        .news {
            position: relative;
            max-width: 1200px;
            width: 90%;
            margin: 0 auto 100px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(255, 105, 255, 0.4);
            cursor: pointer;
            transition: transform 0.5s ease, box-shadow 0.5s ease;
            -webkit-mask-image: radial-gradient(
                ellipse at center,
                rgba(0,0,0,1) 55%,
                rgba(0,0,0,0.85) 68%,
                rgba(0,0,0,0.55) 78%,
                rgba(0,0,0,0.25) 88%,
                rgba(0,0,0,0.0) 100%
            );
            mask-image: radial-gradient(
                ellipse at center,
                rgba(0,0,0,1) 55%,
                rgba(0,0,0,0.85) 68%,
                rgba(0,0,0,0.55) 78%,
                rgba(0,0,0,0.25) 88%,
                rgba(0,0,0,0.0) 100%
            );
        }
        .news-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.25);
            backdrop-filter: blur(28px) saturate(1.25) contrast(1.1);
            z-index: 20;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }
        .news-overlay.active {
            display: flex;
        }
        .news-overlay.active {
            opacity: 1;
        }
        .news-overlay {
            pointer-events: none;
        }
        .news-overlay.active {
            pointer-events: auto;
        }

        .news-carousel {
            position: relative;
            width: 90%;
            max-width: 1000px;
            height: 70vh;
            overflow: hidden;
            transform: scale(0.82) translateY(180px);
            opacity: 0;
            transition:
                transform 1.6s cubic-bezier(0.22, 1, 0.36, 1),
                opacity 1.4s cubic-bezier(0.22, 1, 0.36, 1);
            background: rgba(0,0,0,0.08);
            backdrop-filter: blur(36px) saturate(1.4);
            -webkit-backdrop-filter: blur(36px) saturate(1.4);
            border-radius: 1px;
        }

        .news-overlay.active .news-carousel {
            transform: scale(1.02) translateY(-6px);
            opacity: 1;
            filter: drop-shadow(0 40px 120px rgba(255,105,255,0.11));
        }
        .news-overlay.active .news-carousel {
            animation: settle 0.6s cubic-bezier(0.25, 1, 0.35, 1) forwards;
        }

        @keyframes settle {
            to {
                transform: scale(1) translateY(0);
            }
        }

        .news-slides {
            display: flex;
            height: 100%;
            transition: transform 0.9s cubic-bezier(0.25, 1, 0.35, 1);
        }

        .news-slide {
            min-width: 100%;
            height: 100%;
            position: relative;
            transition: filter 0.45s cubic-bezier(0.25, 1, 0.35, 1);
            filter: blur(0px) brightness(1);
        }

        .news-slides.moving .news-slide {
            filter: blur(1.6px) brightness(0.96);
        }

        .news-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .slide-text {
            position: absolute;
            bottom: 40px;
            left: 40px;
            text-align: left;
            text-shadow: 0 4px 20px #000;
        }

        .slide-text h2 {
            font-size: 3em;
        }

        .slide-text p {
            font-size: 1em;
        }

        .news-arrow {
            position: absolute;
            top: 50%;
            --arrow-scale: 1;
            transform: translateY(-50%) scale(var(--arrow-scale));
            font-size: 3em;
            background: none;
            border: none;
            color: #ff69ff;
            cursor: pointer;
            text-shadow: 0 0 20px #ff69ff;
            opacity: 1;
            transition:
                opacity 0.4s ease,
                transform 0.25s cubic-bezier(0.25, 1, 0.35, 1),
                filter 0.25s ease;
        }

        .news-arrow:hover {
            --arrow-scale: 1.15;
            filter: brightness(1.3);
        }

        .news-arrow:active {
            --arrow-scale: 0.92;
            filter: brightness(0.8);
        }

        .news-arrow.disabled {
            opacity: 0;
            pointer-events: none;
        }

        .news-arrow.left { left: 20px; }
        .news-arrow.right { right: 20px; }

        .news-close {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 2.5em;
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
        }

        .news {
            transition: transform 0.7s cubic-bezier(0.22, 1, 0.36, 1),
                        box-shadow 0.7s cubic-bezier(0.22, 1, 0.36, 1);
        }
        .news:hover {
            transform: scale(1.03);
            box-shadow: 0 30px 80px rgba(255, 105, 255, 0.7);
        }

        .news-img {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.314s ease;
            filter: brightness(0.8);
            filter: brightness(0.82) contrast(0.95) saturate(0.9);
            transition:
                transform 0.314s ease,
                filter 0.6s ease;
        }

        .news:hover .news-img {
            transform: scale(1.1);
            filter: brightness(1);
        }

        .news::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 75%;
            background: linear-gradient(
                to top,
                rgba(0,0,0,0.92),
                rgba(0,0,0,0.55) 35%,
                rgba(0,0,0,0.15) 65%,
                rgba(0,0,0,0.0)
            );
            pointer-events: none;
        }

        .news-text {
            position: absolute;
            bottom: 25px;
            left: 0;
            right: 0;
            z-index: 4;
            pointer-events: none;
        }

        .news-text h2 {
            font-family: 'Bebas Neue', 'Impact', sans-serif;
            font-size: 3.5em;
            margin: 0 0 15px;
            text-shadow: 0 0 20px #ff69ff, 0 6px 15px #000;
            letter-spacing: 3px;
        }

        .news-text p {
            font-family: 'Bebas Neue', 'Impact', sans-serif;
            font-size: 1.5em;
            margin: 8px 0;
            text-shadow: 0 3px 12px #000;
            line-height: 1.3;
            letter-spacing: 2px;
        }

        .releases {
            display: flex;
            flex-direction: column;
            gap: 28px;
            max-width: 920px;
            margin: 0 auto 120px;
            padding: 0 32px;
            position: relative;
            z-index: 3;
        }

        .release {
            cursor: pointer;
            position: relative;
            display: grid;
            grid-template-columns: 72px 1fr;
            align-items: center;
            gap: 22px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }


        .release:hover {
            transform: translateX(4px);
        }

        .release img {
            width: 88px;
            height: 88px;
            object-fit: cover;
            border-radius: 50%;
            transition: transform 0.3s ease, filter 0.3s ease;
            will-change: transform;
        }

        .release:hover img {
            transform: scale(1.02);
            filter: brightness(1.1);
        }

        /* === VINYL HOLE EFFECT === */
        .vinyl {
            position: relative;
            border-radius: 50%;
            overflow: hidden;
            -webkit-mask-image: radial-gradient(circle, transparent 0 14%, black 15%);
            mask-image: radial-gradient(circle, transparent 0 14%, black 15%);
            flex-shrink: 0;
            width: 88px;
            height: 88px;
        }

        .vinyl img {
            animation: rotate 20s linear infinite paused;
            transition: all 0.4s ease;
        }

        .vinyl.playing img {
            animation-play-state: running;
            box-shadow:
                0 0 40px rgba(255, 105, 255, 0.8),
                0 0 80px rgba(255, 105, 255, 0.4);
        }

        .vinyl::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 22%;
            height: 22%;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 1;

            /* микро-текстура внутри отверстия */
            background:
                repeating-radial-gradient(
                    circle,
                    rgba(255,255,255,0.15) 0px,
                    rgba(255,255,255,0.15) 1px,
                    rgba(0,0,0,0.15) 2px,
                    rgba(0,0,0,0.15) 3px
                );

            box-shadow:
                inset 0 0 0 1px rgba(255,255,255,0.45),
                inset 0 0 8px rgba(0,0,0,0.6),
                0 0 2px rgba(255,255,255,0.4);
        }

        .vinyl::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            pointer-events: none;
            z-index: 2;

            /* мягкие виниловые дорожки без тёмного обода */
            background:
                repeating-radial-gradient(
                    circle,
                    rgba(255,255,255,0.028) 0px,
                    rgba(255,255,255,0.028) 1px,
                    rgba(0,0,0,0.018) 2px,
                    rgba(0,0,0,0.018) 3px
                );

            /* очень плавное исчезновение к центру */
            -webkit-mask-image: radial-gradient(
                circle,
                transparent 0%,
                rgba(0,0,0,0.15) 20%,
                rgba(0,0,0,0.6) 32%,
                black 100%
            );
            mask-image: radial-gradient(
                circle,
                transparent 0%,
                rgba(0,0,0,0.15) 20%,
                rgba(0,0,0,0.6) 32%,
                black 100%
            );
        }

        .vinyl.playing::after {
            animation: rotate 20s linear infinite;
        }


        .release p {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Bebas Neue', 'Impact', sans-serif;
            margin: 0;
            font-size: 1.05em;
            letter-spacing: 1.8px;
            white-space: nowrap;
            overflow: hidden;
            opacity: 0.85;
            transition: opacity 0.25s ease;
            justify-content: flex-start;
        }

        .track-name {
            flex: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: left;
            padding-left: 6px;
        }

        .track-plays {
            margin-left: auto;
            margin-right: 7px;
            text-align: right;
            flex-shrink: 0;
        }

        .release:hover p {
            opacity: 1;
            transform: translateX(4px);
        }

        .track-plays {
            flex-shrink: 0;
            font-size: 0.8em;
            opacity: 0.55;
            letter-spacing: 1px;
        }
        .release:hover .track-plays {
            opacity: 0.85;
        }

        .custom-player {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(0);
            width: 63%;
            max-width: 920px;
            padding: 22px 34px;
            border-radius: 64px;
            display: flex;
            align-items: center;
            gap: 28px;
            z-index: 10;

            /* упрощённое стекло без backdrop-filter для стабильности в TG */
            background: linear-gradient(135deg, rgba(68, 57, 57, 0.31) 0%, rgba(84, 96, 100, 0.185) 100%);
            /* box-shadow для глубины */
            box-shadow: 0 8px 32px rgba(0,0,0,0.12), 0 0 2px rgba(255,105,255,0.2);
            transition: transform 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.9s ease, box-shadow 0.6s ease;

            opacity: 0;
            pointer-events: none;
        }

        #playerEffect {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            border-radius: inherit;
            pointer-events: none;
            z-index: 1; /* ниже контента плеера, выше фона */
        }

        .custom-player::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background:
                radial-gradient(
                    circle at 20% 20%,
                    rgba(255,105,255,0.25),
                    transparent 45%
                ),
                radial-gradient(
                    circle at 80% 80%,
                    rgba(120,180,255,0.18),
                    transparent 50%
                );
            opacity: 0.6;
            pointer-events: none;
        }

        .custom-player.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .track-cover {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            position: relative;
            box-shadow: 0 0 40px rgba(255, 105, 255, 0.6);
            animation: rotate 20s linear infinite paused;
            -webkit-mask-image: radial-gradient(circle, transparent 0 18%, black 19%);
            mask-image: radial-gradient(circle, transparent 0 18%, black 19%);
        }

        .track-cover::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            pointer-events: none;
            z-index: 2;

            /* виниловые дорожки в плеере */
            background:
                repeating-radial-gradient(
                    circle,
                    rgba(255,255,255,0.03) 0px,
                    rgba(255,255,255,0.03) 1px,
                    rgba(0,0,0,0.02) 2px,
                    rgba(0,0,0,0.02) 3px
                );

            /* плавное исчезновение к дырке */
            -webkit-mask-image: radial-gradient(
                circle,
                transparent 0%,
                rgba(0,0,0,0.25) 22%,
                black 100%
            );
            mask-image: radial-gradient(
                circle,
                transparent 0%,
                rgba(0,0,0,0.25) 22%,
                black 100%
            );
        }

        .track-cover::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 18%;
            height: 18%;
            border-radius: 50%;
            box-shadow:
                inset 0 0 0 1px rgba(255,255,255,0.35),
                inset 0 0 8px rgba(0,0,0,0.6),
                0 0 6px rgba(0,0,0,0.4);
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .track-cover.playing {
            animation-play-state: running;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .track-info {
            flex: 1;
            text-align: left;
            min-width: 0;
        }

        .track-title {
            font-family: 'Bebas Neue', 'Impact', sans-serif;
            font-size: 1.3em;
            margin: 0;
            text-shadow: 0 2px 10px #ff69ff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            letter-spacing: 2px;
        }

        .track-artist {
            font-family: 'Bebas Neue', 'Impact', sans-serif;
            font-size: 1.1em;
            opacity: 0.9;
            margin: 5px 0 0;
            letter-spacing: 1px;
        }

        .track-name {
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 25px;
            width: 400px;
        }

        .play-pause {
            width: 68px;
            height: 68px;
            background:
                radial-gradient(
                    circle at 30% 30%,
                    rgba(255,255,255,0.35),
                    rgba(255,105,255,0.45)
                );
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;

            box-shadow:
                0 0 30px rgba(255,105,255,0.8),
                inset 0 0 12px rgba(255,255,255,0.25);

            transition: all 0.3s ease;
        }

        .play-pause:hover {
            background: rgba(255, 105, 255, 0.7);
            transform: scale(1.15);
            box-shadow: 0 0 30px rgba(255, 105, 255, 0.8);
        }

        .play-pause svg {
            width: 33px;
            height: 33px;
            fill: #fff;
        }

        .progress-container {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            width: 260px;
        }

        .progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(
                90deg,
                #ffb9ff,
                #caadff,
                #bbe5fe
            );
            border-radius: 4px;
            transition: width 0.1s linear;
            box-shadow: 0 0 10px rgba(255, 105, 255, 0.3);
        }

        .time-left, .time-right {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9em;
            min-width: 33px;
        }

        .time-left { text-align: left; margin-right: 3px; }
        .time-right { text-align: right; margin-left: 3px; }

        @media (max-width: 768px) {
            h1 { font-size: 3em; }
            .news-text h2 { font-size: 2.6em; }
            .news-text p { font-size: 1.5em; }
            .release p { font-size: 1.1em; }

            .custom-player {
                flex-direction: column;
                padding: 33px;
                gap: 33px;
            }

            .track-info { text-align: center; }
            .track-title { font-size: 1.8em; }
            .track-artist { font-size: 1.1em; }

            .controls {
                width: 100%;
                flex-direction: column;
                gap: 15px;
            }

            .progress-wrapper {
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .progress-container {
                flex: 1;
                margin: 0 15px;
                width: 95%;
            }
        }

        @media (max-width: 768px) {
            .releases {
                padding: 20px 10px;
                gap: 30px;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .release:hover {
                transform: scale(1.05);
            }

            .news {
                margin: 0 20px 80px;
            }
        }

        @media (max-width: 480px) {
            .custom-player {
                padding: 15px;
                gap: 15px;
                border-radius: 30px;
            }

            .track-cover {
                width: 66px;
                height: 66px;
            }

            .play-pause {
                width: 50px;
                height: 50px;
            }

            .track-title {
                font-size: 0.68em;
            }

            .progress-wrapper {
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .progress-container {
                flex: 1;
                margin: 0 6px;
                width: 100%;
            }

            .time-left, .time-right {
                font-size: 0.95em;
                min-width: 11px;
            }

            .release p {
                font-size: 0.85em;
            }

            .track-name {
                max-width: 100%;
            }

            .releases {
                padding: 0 20px;
            }
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

    <!-- WebGL Canvas поверх фона -->
    <canvas id="glCanvas"></canvas>
    <canvas id="grainCanvas"></canvas>

    <!-- Частицы -->
    <div class="particles" id="particles"></div>

    <div class="content-layer">
        <h1 id="mainTitle">HINTS MUSIC</h1>

        <div class="news" id="newsBlock">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23ff69ff' width='400' height='400'/%3E%3C/svg%3E" data-src="IMG_7561.jpeg" alt="News image" class="news-img" loading="lazy">
            <div class="news-text">
                <h2>Event</h2>
                <p>12.20.2025<br>HINTS</p>
                <p>New era soon</p>
            </div>
        </div>

        <div class="news-overlay" id="newsOverlay">
            <div class="news-carousel">
                <button class="news-close" id="newsClose">✕</button>

                <div class="news-slides" id="newsSlides">
                    <div class="news-slide active">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23ff69ff' width='400' height='400'/%3E%3C/svg%3E" data-src="IMG_7561.jpeg" alt="" loading="lazy">
                        <div class="slide-text">
                            <h2>12.20.2025</h2>
                            <p>HINTS EVENT<br>New era soon</p>
                        </div>
                    </div>

                    <div class="news-slide">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23ff69ff' width='400' height='400'/%3E%3C/svg%3E" data-src="IMG_7852.jpeg" alt="" loading="lazy">
                        <div class="slide-text">
                            <h2>RELEASE</h2>
                            <p>Nazareth<br>Out now</p>
                        </div>
                    </div>

                    <div class="news-slide">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23ff69ff' width='400' height='400'/%3E%3C/svg%3E" data-src="IMG_7855.jpeg" alt="" loading="lazy">
                        <div class="slide-text">
                            <h2>UPDATE</h2>
                            <p>More shows<br>soon</p>
                        </div>
                    </div>
                </div>

                <button class="news-arrow left" id="newsPrev">‹</button>
                <button class="news-arrow right" id="newsNext">›</button>
            </div>
        </div>

        <div class="releases">
            <div class="release" data-title="Nazareth" onclick="playTrack('track1.mp3', 'Nazareth', 'Slut Online, lindtayl0r', 'IMG_7852.jpeg')">
                <div class="vinyl">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23ff69ff' width='400' height='400'/%3E%3C/svg%3E" data-src="IMG_7852.jpeg" alt="Nazareth" loading="lazy">
                </div>
                <p>
                  <span class="track-name">Slut Online, lindtayl0r - Nazareth</span>
                  <span class="track-plays" data-track="Nazareth">0</span>
                </p>
            </div>

            <div class="release" data-title="Sex & Limbo" onclick="playTrack('track2.mp3', 'Sex & Limbo', 'Slut Online, lindtayl0r', 'IMG_7855.jpeg')">
                <div class="vinyl">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23ff69ff' width='400' height='400'/%3E%3C/svg%3E" data-src="IMG_7855.jpeg" alt="Sex & Limbo" loading="lazy">
                </div>
                <p>
                  <span class="track-name">Slut Online, lindtayl0r - Sex & Limbo</span>
                  <span class="track-plays" data-track="Sex & Limbo">0</span>
                </p>
            </div>

            <div class="release" data-title="SPACEDUST" onclick="playTrack('track3.mp3', 'SPACEDUST', 'Unknown', 'IMG_7856.jpeg')">
                <div class="vinyl">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23ff69ff' width='400' height='400'/%3E%3C/svg%3E" data-src="IMG_7856.jpeg" alt="SPACEDUST" loading="lazy">
                </div>
                <p>
                  <span class="track-name">SPACEDUST</span>
                  <span class="track-plays" data-track="SPACEDUST">0</span>
                </p>
            </div>

            <div class="release" data-title="Interstellar" onclick="playTrack('track4.mp3', 'Interstellar', 'XSDC', 'IMG_7857.jpeg')">
                <div class="vinyl">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23ff69ff' width='400' height='400'/%3E%3C/svg%3E" data-src="IMG_7857.jpeg" alt="Interstellar" loading="lazy">
                </div>
                <p>
                  <span class="track-name">XSDC - Interstellar</span>
                  <span class="track-plays" data-track="Interstellar">0</span>
                </p>
            </div>
        </div>

        <div class="custom-player" id="customPlayer">
            <canvas id="playerEffect"></canvas>
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23ff69ff' width='400' height='400'/%3E%3C/svg%3E" data-src="IMG_7851.jpeg" alt="Cover" class="track-cover" id="trackCover" loading="lazy">

            <div class="track-info">
                <h3 class="track-title" id="trackTitle">HINTS MUSIC</h3>
                <p class="track-artist" id="trackArtist">Intro</p>
            </div>

            <div class="controls">
                <div class="play-pause" id="playPause">
                    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                </div>

                <div class="progress-wrapper">
                    <div class="time-left" id="timeLeft">0:00</div>
                    <div class="progress-container" id="progressContainer">
                        <div class="progress" id="progress"></div>
                    </div>
                    <div class="time-right" id="timeRight">0:00</div>
                </div>
            </div>
        </div>
    </div>

    <audio id="audioPlayer" loop></audio>

    <script>
        // === AUDIO SETUP ===
        const audio = document.getElementById('audioPlayer');
        const customPlayer = document.getElementById('customPlayer');
        const trackCover = document.getElementById('trackCover');
        const trackTitle = document.getElementById('trackTitle');
        const trackArtist = document.getElementById('trackArtist');
        const playPause = document.getElementById('playPause');
        const progressContainer = document.getElementById('progressContainer');
        const progress = document.getElementById('progress');
        const timeLeft = document.getElementById('timeLeft');
        const timeRight = document.getElementById('timeRight');
        const h1 = document.getElementById('mainTitle');

        let isPlaying = false;
        let hasStartedPlaying = false;

        // === TELEGRAM MINI APP SETUP ===
        const isTelegram = !!(window.Telegram && Telegram.WebApp);
        let tgUser = null;

        if (isTelegram) {
            const tg = Telegram.WebApp;

            // defer ready/expand until first interaction for iOS safety
            const tgInitOnce = () => {
                tg.ready();
                tg.expand();
                tg.enableClosingConfirmation();
                document.removeEventListener('pointerdown', tgInitOnce);
            };
            document.addEventListener('pointerdown', tgInitOnce, { once: true });

            tgUser = tg.initDataUnsafe?.user || null;

            // Theme sync (soft, non-destructive)
            if (tg.themeParams?.bg_color) {
                document.documentElement.style.backgroundColor = tg.themeParams.bg_color;
            }
        }

        // === PRELOAD AUDIO TRACKS ===
        const trackCache = {};
        const TRACKS_TO_PRELOAD = [
            'track1.mp3',
            'track2.mp3',
            'track3.mp3',
            'track4.mp3'
        ];

        function preloadTracks() {
            TRACKS_TO_PRELOAD.forEach(src => {
                fetch(src)
                    .then(r => r.blob())
                    .then(blob => {
                        const url = URL.createObjectURL(blob);
                        trackCache[src] = url;
                    })
                    .catch(err => {
                        console.warn('Preload failed:', src, err);
                    });
            });
        }

        let idleTimer = null;
        let immersive = false;
        const IDLE_DELAY = isTelegram ? 12000 : 18000; // быстрее уходим в immersive в TG

        // Audio Context для анализа
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const analyser = audioContext.createAnalyser();
        analyser.fftSize = isTelegram ? 128 : 256;
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);

        let audioSource = null;

        
        
        function playTrack(src, title, artist, cover) {
            audio.src = trackCache[src] || src;

            if (!audioSource) {
                audioSource = audioContext.createMediaElementSource(audio);
                audioSource.connect(analyser);
                analyser.connect(audioContext.destination);
            }

            if (!hasStartedPlaying) {
                audio.play().then(() => {
                    audioContext.resume();
                    isPlaying = true;
                    hasStartedPlaying = true;
                    updatePlayPause();
                    trackCover.classList.add('playing');
                    customPlayer.classList.add('visible');
                    resetIdleTimer();
                }).catch(err => {
                    console.warn("Audio playback failed:", err);
                });
            } else {
                audio.play().then(() => {
                    audioContext.resume();
                    isPlaying = true;
                    updatePlayPause();
                    trackCover.classList.add('playing');
                    customPlayer.classList.add('visible');
                    resetIdleTimer();
                }).catch(err => {
                    console.warn("Audio playback failed:", err);
                });
            }

            trackTitle.textContent = title;
            trackArtist.textContent = artist || 'Unknown';
            trackCover.src = cover;

            document.querySelectorAll('.vinyl').forEach(v => {
                v.classList.remove('playing');
            });

            const activeRelease = document.querySelector(`.release[data-title="${title}"]`);
            if (activeRelease) {
                const vinyl = activeRelease.querySelector('.vinyl');
                if (vinyl) vinyl.classList.add('playing');
            }

            h1.textContent = 'HINTS MUSIC — ' + title;
            if (isTelegram && Telegram.WebApp?.HapticFeedback) {
                Telegram.WebApp.HapticFeedback.impactOccurred('medium');
            }
        }

        playPause.addEventListener('click', () => {
            if (isPlaying) {
                audio.pause();
                isPlaying = false;
                trackCover.classList.remove('playing');
                document.querySelectorAll('.vinyl').forEach(v => {
                    v.classList.remove('playing');
                });
                updatePlayPause();
                customPlayer.classList.remove('visible');
                resetIdleTimer();
            } else {
                audio.play().catch(err => {
                    console.warn("Audio playback failed:", err);
                });
                audioContext.resume();
                isPlaying = true;
                trackCover.classList.add('playing');
                updatePlayPause();
                customPlayer.classList.add('visible');
                resetIdleTimer();
            }
        });

        function enterImmersive() {
            if (!isPlaying || immersive) return;
            immersive = true;
            document.body.classList.add('immersive');
        }

        function exitImmersive() {
            immersive = false;
            document.body.classList.remove('immersive');
            resetIdleTimer();
        }

        function resetIdleTimer() {
            clearTimeout(idleTimer);
            if (isPlaying) {
                idleTimer = setTimeout(enterImmersive, IDLE_DELAY);
            }
        }

        function updatePlayPause() {
            const svg = playPause.querySelector('svg');
            if (isPlaying) {
                svg.innerHTML = '<path d="M6 4h4v16H6zM14 4h4v16h-4z"/>';
            } else {
                svg.innerHTML = '<path d="M8 5v14l11-7z"/>';
            }
        }

        audio.addEventListener('timeupdate', () => {
            if (audio.duration) {
                const percent = (audio.currentTime / audio.duration) * 100;
                progress.style.width = percent + '%';
                timeLeft.textContent = formatTime(audio.currentTime);
                timeRight.textContent = formatTime(audio.duration);
            }
        });

        progressContainer.addEventListener('click', (e) => {
            const rect = progressContainer.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const percent = Math.max(0, Math.min(1, x / rect.width));
            audio.currentTime = percent * audio.duration;
        });

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        let lastScroll = 0;
        window.addEventListener('scroll', () => {
            if (hasStartedPlaying) {
                if (window.scrollY > lastScroll) {
                    customPlayer.style.transform = 'translateX(-50%) translateY(150px)';
                } else {
                    customPlayer.style.transform = 'translateX(-50%) translateY(0)';
                }
                lastScroll = window.scrollY;
            }
        });

        // === WEBGL SHADER BACKGROUND ===
        const canvas = document.getElementById('glCanvas');
        const gl = canvas.getContext('webgl', {
            antialias: false,
            preserveDrawingBuffer: false
        });

        if (!gl) {
            console.error('WebGL не поддерживается');
        }

        function resizeCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const ww = window.innerWidth;
            const wh = window.innerHeight;

            canvas.width = ww * dpr;
            canvas.height = wh * dpr;

            // Подгоняем размер под широкие экраны
            let scaleX = 1.3;
            let scaleY = 1.3;

            if (ww / wh > 1.6) { // широкие мониторы
                scaleX = 1.6;
                scaleY = 1.3;
            }

            canvas.style.width = `${scaleX * 100}vw`;
            canvas.style.height = `${scaleY * 100}vh`;

            // Смещаем только немного, чтобы центр был примерно в середине
            canvas.style.transform = `translate(-${(scaleX-1)*50}%, -${(scaleY-1)*50}%)`;

            gl.viewport(0, 0, canvas.width, canvas.height);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        const vertexShaderSource = `
            attribute vec2 a_position;
            void main() {
                gl_Position = vec4(a_position, 0.0, 1.0);
            }
        `;

        const fragmentShaderSource = `
            precision mediump float;
            #define BLUR_SAMPLES 5
            uniform float u_time;
            uniform vec2 u_resolution;
            uniform float u_audio;

            // --- Аудио сглаживание и бас ---
            float audio = smoothstep(0.03, 0.6, u_audio);
            float bass = pow(audio, 1.1);

            vec3 pink = vec3(1.0, 0.41, 1.0);
            vec3 hotpink = vec3(1.0, 0.1, 0.8);
            vec3 magenta = vec3(1.0, 0.2, 0.9);
            vec3 purple = vec3(0.7, 0.1, 1.0);
            vec3 cyan = vec3(0.3, 1.0, 1.0);
            vec3 bassBlue = vec3(0.25, 0.05, 1.0);
            vec3 spectralWhite = vec3(0.85, 0.75, 0.95);

            // --- Soft noise ---
            float hash(vec2 p){
                p = fract(p * vec2(123.34, 456.21));
                p += dot(p,p+45.32);
                return fract(p.x*p.y);
            }

            float softNoise(vec2 p){
                vec2 i = floor(p);
                vec2 f = fract(p);
                f = f*f*(3.0-2.0*f);
                float a = hash(i);
                float b = hash(i+vec2(1.0,0.0));
                float c = hash(i+vec2(0.0,1.0));
                float d = hash(i+vec2(1.0,1.0));
                return mix(mix(a,b,f.x), mix(c,d,f.x), f.y)*0.9;
            }

            void main() {
                vec2 uv = gl_FragCoord.xy / u_resolution.xy;
                vec2 p = uv*2.0 - 1.0;
                p.x *= u_resolution.x/u_resolution.y;

                // --- Lens distortion (стеклянная линза) ---
                float r = length(p);
                float strength = 0.35; // сила линзы, 0.0 = нет эффекта, 1.0 = сильное искажение
                vec2 lensUV = p * (1.0 - strength * r*r);
                p = mix(p, lensUV, 0.7); // смешиваем с оригиналом, 0.7 = баланс эффекта

                // --- Динамический центр, распределение по экрану ---
                vec2 drift = vec2(
                    sin(u_time*0.12 + uv.y*3.1) * 0.18,
                    cos(u_time*0.15 + uv.x*2.7) * 0.18
                );
                p += drift;

                // --- Фрактальный шум-дрейф ---
                float fn = 0.0;
                vec2 fp = p;
                for(int i=0;i<3;i++){
                    fn += softNoise(fp + u_time*0.04) * (0.5/float(i+1));
                    fp = fp*1.6 + 0.15;
                }
                p += fn*(0.12 + bass*0.28);

                // --- Локальный органический warp ---
                float t = u_time*0.14;
                vec2 warp = vec2(sin(p.y*3.7+t), cos(p.x*4.1-t));
                p += warp*(0.035 + bass*0.12);

                // --- Жидкий displace ---
                vec2 displace = vec2(
                    softNoise(p.yx*2.0 + u_time*0.42),
                    softNoise(p.xy*1.8 - u_time*0.38)
                )*(0.24 + bass*0.72);
                vec2 displacedUV = p + displace;

                // --- Bass-driven flow ---
                float bassFlow = smoothstep(0.05, 0.6, u_audio);
                bassFlow = pow(bassFlow, 1.4);

                // --- Flow noise и маска (дыхание стекла) ---
                float flowNoise =
                    softNoise(displacedUV*2.4 + u_time*0.22 + bassFlow*0.6) +
                    softNoise(displacedUV.yx*1.7 - u_time*0.18 - bassFlow*0.4);

                float flowMask = smoothstep(-0.3 + bassFlow*0.25, 0.7, flowNoise);

                // дополнительное объёмное дыхание
                displace *= 1.0 + bassFlow*0.35;

                // --- Основная цветовая логика ---
                vec3 color = mix(pink, hotpink, softNoise(displacedUV*1.3 + u_time*0.12));
                color = mix(color, magenta, softNoise(displacedUV*2.1 - u_time*0.18)*0.55);
                color = mix(color, cyan, softNoise(displacedUV.yx*1.6 + u_time*0.15)*0.35);

                // --- Волны ---
                float waves = sin(length(displacedUV*3.0)*7.0 - u_time*2.0 + bass*6.0);
                waves += cos(length(displacedUV*3.5)*11.0 + u_time*1.4)*0.6;
                waves = waves*0.5 + 0.5;
                color = mix(color, purple, waves*0.6);

                // --- Бас-слой и пульс ---
                float bassPulse = sin(u_time*3.0 + length(displacedUV)*8.0)*0.5 + 0.5;
                bassPulse *= pow(bass, 1.6); // усиление реакции на сильный бас

                // Мягкий trail с инерцией
                float trail = smoothstep(0.15, 1.0, bassPulse);
                trail *= 0.35 + bass * 0.45;

                // Trail displacement (след в стекле)
                vec2 trailDir = normalize(displacedUV + 0.0001);
                displacedUV += trailDir * trail * 0.08;

                // Цветовой акцент на бас
                vec3 bassAccent = mix(bassBlue, cyan, trail);

                // Добавляем к основному цвету
                color = mix(color, color + bassAccent*0.6, trail);

                // Дополнительный subtle пульс всего фона по басу
                float globalPulse = 0.85 + 0.25*sin(u_time*0.6 + length(displacedUV)*2.2);
                globalPulse += bass*0.3;
                color *= globalPulse;

                // --- Мягкая виньетка, но без белого снизу ---
                float vignette = smoothstep(1.25, 0.0, length(p));
                color *= mix(0.45,1.2,vignette);

                // --- Мелкий дрейф формы ---
                float drift2 = sin(u_time*0.25 + p.x*2.0)*cos(u_time*0.18 + p.y*1.7);
                color *= 1.0 + drift2*0.06;

                // --- Цветовой баланс и финальная коррекция ---
                vec3 redBias = vec3(1.12,0.78,0.9);
                color *= redBias;
                float avg = (color.r+color.g+color.b)/3.0;
                color = mix(vec3(avg), color, 1.2);
                color = clamp(color,0.0,1.0);

                // --- Subtle glass blur ---
                vec2 blurStep = vec2(1.0) / u_resolution.xy;

                vec3 blur =
                    color * 0.4 +
                    vec3(
                        softNoise(displacedUV + blurStep*1.2),
                        softNoise(displacedUV - blurStep*1.1),
                        softNoise(displacedUV + blurStep.yx*1.0)
                    ) * 0.6;

                // Trail усиливает размытие
                color = mix(color, blur, 0.55 + trail * 0.25);

                gl_FragColor = vec4(color*1.04,0.88);
            }
        `;


        function createShader(gl, type, source) {
            const shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);
            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                console.error(gl.getShaderInfoLog(shader));
                gl.deleteShader(shader);
                return null;
            }
            return shader;
        }

        const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);
        const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);

        const program = gl.createProgram();
        gl.attachShader(program, vertexShader);
        gl.attachShader(program, fragmentShader);
        gl.linkProgram(program);

        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
            console.error(gl.getProgramInfoLog(program));
        }

        const positionBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
        const positions = new Float32Array([
            -1, -1,
             1, -1,
            -1,  1,
             1,  1,
        ]);
        gl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);

        const positionLocation = gl.getAttribLocation(program, 'a_position');
        const timeLocation = gl.getUniformLocation(program, 'u_time');
        const resolutionLocation = gl.getUniformLocation(program, 'u_resolution');
        const audioLocation = gl.getUniformLocation(program, 'u_audio');

        let startTime = Date.now();
        let smoothAudio = 0.01;
        let smoothAudioLast = 0.01;


        function render() {
            analyser.getByteFrequencyData(dataArray);
            const rawAudio = Math.min(
                1.0,
                (dataArray.reduce((a, b) => a + b) / bufferLength / 255.0) * (isTelegram ? 1.0 : 1.25)
            );

            // Экспоненциальное сглаживание (инерция)
            const rise = 0.15;  // скорость реакции на удар
            const fall = 0.01;  // скорость затухания

            // Two-stage smoothing for more natural response
            const delta = rawAudio - smoothAudio;
            smoothAudio += delta * (delta > 0.0 ? rise : fall);
            const deltaLast = smoothAudio - smoothAudioLast;
            smoothAudioLast += deltaLast * (deltaLast > 0.0 ? rise : fall);

            gl.clearColor(0, 0, 0, 0);
            gl.clear(gl.COLOR_BUFFER_BIT);

            gl.useProgram(program);

            gl.enableVertexAttribArray(positionLocation);
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

            gl.uniform1f(timeLocation, (Date.now() - startTime) / 1000.0);
            gl.uniform2f(resolutionLocation, canvas.width, canvas.height);
            gl.uniform1f(audioLocation, smoothAudioLast);

            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

            requestAnimationFrame(render);
        }
        render();
        // Preload audio on first user interaction or page load
        window.addEventListener('load', preloadTracks, { once: true });

        // === GRAIN POST-PROCESS LAYER ===
        const grainCanvas = document.getElementById('grainCanvas');
        const ggl = grainCanvas.getContext('webgl');


        function resizeGrain() {
            const dpr = window.devicePixelRatio || 1;
            const ww = window.innerWidth;
            const wh = window.innerHeight;

            grainCanvas.width = ww * dpr;
            grainCanvas.height = wh * dpr;

            let scaleX = 1.3;
            let scaleY = 1.3;

            if (ww / wh > 1.6) {
                scaleX = 1.6;
                scaleY = 1.3;
            }

            grainCanvas.style.width = `${scaleX * 100}vw`;
            grainCanvas.style.height = `${scaleY * 100}vh`;
            grainCanvas.style.transform = `translate(-${(scaleX-1)*50}%, -${(scaleY-1)*50}%)`;

            ggl.viewport(0, 0, grainCanvas.width, grainCanvas.height);
        }
        resizeGrain();
        addEventListener('resize', resizeGrain);

        // --- Shaders ---
        const grainVS = `
            attribute vec2 p;
            void main() {
                gl_Position = vec4(p,0.,1.);
            }
            `;

        const grainFS = `
            precision mediump float;
            uniform vec2 r;
            uniform float t;

            float hash(vec2 p) {
                return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123);
            }

            float noise(vec2 p) {
                vec2 i = floor(p);
                vec2 f = fract(p);
                f = f * f * (3.0 - 5.0 * f);
                float a = hash(i);
                float b = hash(i + vec2(1.0, 0.0));
                float c = hash(i + vec2(0.0, 1.0));
                float d = hash(i + vec2(1.0, 1.0));
                return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);
            }

            float fbm(vec2 p) {
                float v = 0.0;
                float a = 0.6;
                for (int i = 0; i < 4; i++) {
                    v += a * noise(p);
                    p *= 2.9;
                    a *= 0.5;
                }
                return v;
            }

            void main() {
                vec2 uv = gl_FragCoord.xy / r.xy;
                vec2 center = uv - 0.5;
                float dist = length(center);

                float time = t * 0.15;

                // liquid flow
                vec2 flow = vec2(
                    fbm(uv * 3.0 + time),
                    fbm(uv * 3.0 - time)
                ) - 0.5;

                float mask = smoothstep(0.9, 0.3, dist);
                vec2 warpedUV = uv + flow * 0.035 * mask;

                // shimmer
                float shimmer = sin((uv.y + uv.x) * 6.0 + time * 4.0) * 0.02;
                warpedUV += shimmer * mask;

                // grain glass
                float g = fbm(warpedUV * r.xy * 0.015 + time * 2.0);
                float scan = sin(warpedUV.y * r.y * 1.2);

                float grain = g * 0.6 + scan * 0.15;

                gl_FragColor = vec4(vec3(grain), 1.0);
            }
        `;

        function gshader(type, src){
            const s = ggl.createShader(type);
            ggl.shaderSource(s, src);
            ggl.compileShader(s);
            return s;
        }

        const gp = ggl.createProgram();
        ggl.attachShader(gp, gshader(ggl.VERTEX_SHADER, grainVS));
        ggl.attachShader(gp, gshader(ggl.FRAGMENT_SHADER, grainFS));
        ggl.linkProgram(gp);

        const gbuf = ggl.createBuffer();
        ggl.bindBuffer(ggl.ARRAY_BUFFER, gbuf);
        ggl.bufferData(
            ggl.ARRAY_BUFFER,
            new Float32Array([-1,-1, 1,-1, -1,1, 1,1]),
            ggl.STATIC_DRAW
        );

        const locP = ggl.getAttribLocation(gp, 'p');
        const locT = ggl.getUniformLocation(gp, 't');
        const locR = ggl.getUniformLocation(gp, 'r');

        // --- Grain render loop ---
        function renderGrain(){
            ggl.clear(ggl.COLOR_BUFFER_BIT);
            ggl.useProgram(gp);

            ggl.enableVertexAttribArray(locP);
            ggl.bindBuffer(ggl.ARRAY_BUFFER, gbuf);
            ggl.vertexAttribPointer(locP, 2, ggl.FLOAT, false, 0, 0);

            ggl.uniform1f(locT, performance.now() * 0.001);
            ggl.uniform2f(locR, grainCanvas.width, grainCanvas.height);

            ggl.drawArrays(ggl.TRIANGLE_STRIP, 0, 4);
            requestAnimationFrame(renderGrain);
        }
        renderGrain();

        // === PARTICLES (POOLED) ===
        const particles = [];
        const MAX_PARTICLES = 24;
        const particlesContainer = document.getElementById('particles');

        function createParticle() {
            let particle = particles.find(p => !p.active);
            if (!particle && particles.length < MAX_PARTICLES) {
                const el = document.createElement('div');
                el.className = 'particle';
                particlesContainer.appendChild(el);
                particle = { el, active: true };
                particles.push(particle);
            }
            if (particle) {
                particle.active = true;
                particle.el.style.left = Math.random() * 100 + '%';
                particle.el.style.animationDuration = (Math.random() * 3 + 2) + 's';
                particle.el.style.animationDelay = Math.random() * 2 + 's';
                particle.el.style.display = 'block';
                setTimeout(() => {
                    particle.active = false;
                    particle.el.style.display = 'none';
                }, 5000);
            }
        }

        setInterval(() => {
            if (isPlaying) {
                createParticle();
            }
        }, 420);

        // === IMMERSIVE / IDLE MODE LISTENERS ===
        ['mousemove', 'mousedown', 'touchstart', 'keydown'].forEach(evt => {
            window.addEventListener(evt, () => {
                if (immersive) {
                    exitImmersive();
                } else {
                    resetIdleTimer();
                }
            }, { passive: true });
        });

        // === LAZY IMAGE LOADING WITH INTERSECTION OBSERVER ===
        document.addEventListener('DOMContentLoaded', function() {
            const lazyImages = document.querySelectorAll('img[loading="lazy"]');
            if ('IntersectionObserver' in window) {
                const observer = new IntersectionObserver((entries, obs) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            if (entry.target.dataset && entry.target.dataset.src) {
                                entry.target.src = entry.target.dataset.src;
                            }
                            obs.unobserve(entry.target);
                        }
                    });
                });
                lazyImages.forEach(img => observer.observe(img));
            } else {
                // Fallback: just set src
                lazyImages.forEach(img => {
                    if (img.dataset && img.dataset.src) {
                        img.src = img.dataset.src;
                    }
                });
            }
        });

    </script>

    <script>
    // === AUDIOREACTIVE PLAYER EFFECT LAYER ===
    (function() {
        const effectCanvas = document.getElementById('playerEffect');
        if (!effectCanvas) return;
        const ctx = effectCanvas.getContext('2d');
        const customPlayer = document.getElementById('customPlayer');

        function resize() {
            effectCanvas.width = customPlayer.offsetWidth;
            effectCanvas.height = customPlayer.offsetHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        function noise(x, y) {
            return (Math.sin(x*12.9898 + y*78.233) * 43758.5453) % 1;
        }

        function render() {
            ctx.clearRect(0, 0, effectCanvas.width, effectCanvas.height);

            analyser.getByteFrequencyData(dataArray);
            const rawAudio = (dataArray.reduce((a,b)=>a+b,0)/bufferLength)/255;

            // Плавное сглаживание (двухступенчатое)
            const rise = 0.12;  // скорость увеличения
            const fall = 0.04;  // скорость уменьшения
            if (typeof render.smoothAudio === 'undefined') render.smoothAudio = 0.01;
            if (typeof render.smoothAudioLast === 'undefined') render.smoothAudioLast = 0.01;

            let delta = rawAudio - render.smoothAudio;
            render.smoothAudio += delta * (delta > 0 ? rise : fall);
            let deltaLast = render.smoothAudio - render.smoothAudioLast;
            render.smoothAudioLast += deltaLast * (deltaLast > 0 ? rise : fall);

            const audioLevel = render.smoothAudioLast;

            const w = effectCanvas.width;
            const h = effectCanvas.height;

            // базовый градиент стекла
            const gradient = ctx.createLinearGradient(0,0,w,h);
            gradient.addColorStop(0, `rgba(255,105,255,${0.04 + audioLevel*0.2})`);
            gradient.addColorStop(1, `rgba(120,180,255,${0.03 + audioLevel*0.15})`);

            ctx.fillStyle = gradient;
            ctx.fillRect(0,0,w,h);

            // мягкий шум поверх
            const imageData = ctx.getImageData(0,0,w,h);
            const data = imageData.data;
            for (let i=0; i<data.length; i+=4) {
                const nx = (i/4)%w;
                const ny = Math.floor((i/4)/w);
                const n = noise(nx*0.161 + performance.now()*0.001, ny*0.1);
                data[i] += n*30*audioLevel;     // R
                data[i+1] += n*20*audioLevel;   // G
                data[i+2] += n*25*audioLevel;   // B
                // Alpha остаётся из gradient
            }

            // --- Lens distortion (стеклянная линза) ---
            // После применения шума, до putImageData.
            for (let y = 0; y < h; y++) {
                for (let x = 0; x < w; x++) {
                    const dx = (x / w - 0.5) * 2.0;
                    const dy = (y / h - 0.5) * 2.0;
                    const r = Math.sqrt(dx*dx + dy*dy);
                    const strength = 0.66; // усиленная сила линзы
                    const factor = 1.0 - strength * r*r;
                    const idx = (y*w + x)*4;
                    data[idx + 0] = data[idx + 0] * factor;
                    data[idx + 1] = data[idx + 1] * factor;
                    data[idx + 2] = data[idx + 2] * factor;
                    // alpha не трогаем
                }
            }

            ctx.putImageData(imageData,0,0);

            requestAnimationFrame(render);
        }
        render();
    })();
    </script>

    <script>
    // === NEWS OVERLAY CAROUSEL ===
    const newsBlock = document.getElementById('newsBlock');
    const newsOverlay = document.getElementById('newsOverlay');
    const slides = document.getElementById('newsSlides');
    const prev = document.getElementById('newsPrev');
    const next = document.getElementById('newsNext');
    const closeBtn = document.getElementById('newsClose');

    let slideIndex = 0;

    function updateSlides() {
        slides.classList.add('moving');
        slides.style.transform = `translateX(-${slideIndex * 100}%)`;

        clearTimeout(slides._t);
        slides._t = setTimeout(() => {
            slides.classList.remove('moving');
        }, 420);
        updateArrows();
    }

    function updateArrows() {
        if (slideIndex <= 0) {
            prev.classList.add('disabled');
        } else {
            prev.classList.remove('disabled');
        }

        if (slideIndex >= slides.children.length - 1) {
            next.classList.add('disabled');
        } else {
            next.classList.remove('disabled');
        }
    }

    newsBlock.addEventListener('click', () => {
        newsOverlay.classList.add('active');
        slideIndex = 0;
        updateSlides();
        updateArrows();
    });

    closeBtn.addEventListener('click', () => {
        newsOverlay.classList.remove('active');
    });

    newsOverlay.addEventListener('click', (e) => {
        if (e.target === newsOverlay) {
            newsOverlay.classList.remove('active');
        }
    });


    prev.addEventListener('click', () => {
        slideIndex = Math.max(0, slideIndex - 1);
        updateSlides();
    });

    next.addEventListener('click', () => {
        slideIndex = Math.min(slides.children.length - 1, slideIndex + 1);
        updateSlides();
    });
    </script>
    <!-- Новый скрипт отслеживания прослушиваний (SNAPSHOT-версия) -->
    <script>
    (function() {
        if (!isTelegram || !tgUser) return;
        // --- Константы и ключи ---
        const TRACKS_KEY = 'hints_trackPlays_v2';
        const TOTAL_KEY = 'hints_totalPlays_v2';
        const SESSION_KEY = 'hints_sessionStart_v2';

        // --- Восстановление состояния ---
        let sessionStart = Number(localStorage.getItem(SESSION_KEY)) || Date.now();
        localStorage.setItem(SESSION_KEY, sessionStart);

        let totalPlays = Number(localStorage.getItem(TOTAL_KEY)) || 0;
        let tracksPlayed = {};
        try {
            tracksPlayed = JSON.parse(localStorage.getItem(TRACKS_KEY)) || {};
        } catch(e) {
            tracksPlayed = {};
        }

        // --- UI обновление ---
        function updatePlaysUI(track, count) {
            const el = document.querySelector(`.track-plays[data-track="${CSS.escape(track)}"]`);
            if (el) el.textContent = count;
        }
        // Инициализация UI и миграция формата
        document.querySelectorAll('.track-plays').forEach(el => {
            const key = el.dataset.track;
            let v = tracksPlayed[key];
            if (!v) {
                v = { count: 0, seconds: 0 };
                tracksPlayed[key] = v;
            } else if (typeof v === "number") {
                v = { count: v, seconds: 0 };
                tracksPlayed[key] = v;
            } else if (typeof v === "object" && v.plays !== undefined) {
                v = { count: v.plays, seconds: v.seconds || 0 };
                tracksPlayed[key] = v;
            }
            el.textContent = v.count;
        });
        localStorage.setItem(TRACKS_KEY, JSON.stringify(tracksPlayed));

        // --- Сбор snapshot для отправки ---
        function getSnapshot() {
            // Копия, чтобы не было мутаций по ссылке
            let tracksCopy = {};
            for (const k in tracksPlayed) {
                // Глубокая копия объекта (count, seconds)
                if (tracksPlayed[k] && typeof tracksPlayed[k] === 'object') {
                    tracksCopy[k] = { count: tracksPlayed[k].count, seconds: tracksPlayed[k].seconds };
                }
            }
            const sessionSeconds = Math.floor((Date.now() - sessionStart) / 1000);
            return {
                totalPlays,
                tracksPlayed: tracksCopy,
                sessionSeconds
            };
        }

        // --- События и отправка ---
        async function sendEvent(eventType, extra = {}) {
            // Всегда отправляем полный snapshot
            const details = Object.assign({}, getSnapshot(), extra);
            const payload = {
                userId: tgUser?.id || null,
                eventType,
                details,
                timestamp: Date.now()
            };
            try {
                await fetch('/track', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                    keepalive: true
                });
            } catch (e) {
                // Молча
            }
        }

        // --- Хук playTrack ---
        function hookPlayTrack() {
            if (typeof window.playTrack !== 'function') {
                requestAnimationFrame(hookPlayTrack);
                return;
            }
            const orig = window.playTrack;
            let trackTimer = null;
            let currentTrack = null;
            let currentTrackStart = null;
            window.playTrack = function(src, title, artist, cover) {
                // Завершаем предыдущий трек
                if (currentTrack && tracksPlayed[currentTrack]) {
                    const elapsed = Math.floor((Date.now() - currentTrackStart) / 1000);
                    tracksPlayed[currentTrack].seconds += elapsed;
                    localStorage.setItem(TRACKS_KEY, JSON.stringify(tracksPlayed));
                }
                // Новый трек
                currentTrack = title;
                currentTrackStart = Date.now();
                if (!tracksPlayed[title]) tracksPlayed[title] = { count: 0, seconds: 0 };
                tracksPlayed[title].count++;
                localStorage.setItem(TRACKS_KEY, JSON.stringify(tracksPlayed));
                updatePlaysUI(title, tracksPlayed[title].count);
                totalPlays++;
                localStorage.setItem(TOTAL_KEY, totalPlays);
                orig(src, title, artist, cover);
                sendEvent('track_play', { track: title, artist });
                // Таймер для track_update (каждые 5 сек отправляет snapshot)
                if (trackTimer) clearInterval(trackTimer);
                trackTimer = setInterval(() => {
                    if (currentTrack && tracksPlayed[currentTrack]) {
                        tracksPlayed[currentTrack].seconds += 5;
                        localStorage.setItem(TRACKS_KEY, JSON.stringify(tracksPlayed));
                        sendEvent('track_update', { track: currentTrack });
                    }
                }, 5000);
            };
            // Также сохраняем на выгрузке
            window.addEventListener('beforeunload', () => {
                if (currentTrack && tracksPlayed[currentTrack]) {
                    const elapsed = Math.floor((Date.now() - currentTrackStart) / 1000);
                    tracksPlayed[currentTrack].seconds += elapsed;
                    localStorage.setItem(TRACKS_KEY, JSON.stringify(tracksPlayed));
                }
                sendEvent('session_end');
            });
        }
        hookPlayTrack();

        // --- Сессия ---
        sendEvent('session_start');
        setInterval(() => {
            sendEvent('session_update');
        }, 10000);
    })();
    </script>

</body>
</html>
